const canvas=document.getElementById("game"),context=canvas.getContext("2d");let grid=16,count=0,snake={x:160,y:160,dx:grid,dy:0,cells:[],maxCells:4},apple={x:320,y:320},points=0;const mediaQuery=window.matchMedia("(max-width: 500px)"),control=document.querySelector(".control");function getRandomInt(e,n){return Math.floor(Math.random()*(n-e))+e}function notif(){document.getElementById("gameLost").className="active",setTimeout((()=>{document.getElementById("gameLost").className="hidden"}),900)}function loop(){requestAnimationFrame(loop),++count<4||(count=0,context.clearRect(0,0,canvas.width,canvas.height),snake.x+=snake.dx,snake.y+=snake.dy,snake.x<0?snake.x=canvas.width-grid:snake.x>=canvas.width&&(snake.x=0),snake.y<0?snake.y=canvas.height-grid:snake.y>=canvas.height&&(snake.y=0),snake.cells.unshift({x:snake.x,y:snake.y}),snake.cells.length>snake.maxCells&&snake.cells.pop(),context.fillStyle="red",context.fillRect(apple.x,apple.y,grid-1,grid-1),context.fillStyle="green",snake.cells.forEach((function(e,n){context.fillRect(e.x,e.y,grid-1,grid-1),e.x===apple.x&&e.y===apple.y&&(snake.maxCells++,points++,document.getElementById("count").innerHTML=`${points}`,apple.x=getRandomInt(0,25)*grid,apple.y=getRandomInt(0,25)*grid);for(var a=n+1;a<snake.cells.length;a++)e.x===snake.cells[a].x&&e.y===snake.cells[a].y&&(notif(),snake.x=160,snake.y=160,snake.cells=[],snake.maxCells=4,snake.dx=grid,snake.dy=0,points=0,document.getElementById("count").innerHTML=`${points}`,apple.x=getRandomInt(0,25)*grid,apple.y=getRandomInt(0,25)*grid)})))}mediaQuery.matches&&(control.innerHTML='\n  <a href="#"><div id="btn-up" class="btn"></div></a>\n  <div class="control__side">\n      <a href="#"><div id="btn-left" class="btn"></div></a>\n      <a href="#"><div id="btn-right" class="btn"></div></a>\n  </div>\n  <a href="#"><div id="btn-down" class="btn"></div></a>\n  ',canvas.height="350",canvas.width="350",grid=14,snake.x=154,snake.y=154,apple.x=308,apple.y=308,snake.dx=grid,document.getElementById("gameLost").style.fontSize="24px"),document.addEventListener("keydown",(function(e){37===e.which&&0===snake.dx?(snake.dx=-grid,snake.dy=0):38===e.which&&0===snake.dy?(snake.dy=-grid,snake.dx=0):39===e.which&&0===snake.dx?(snake.dx=grid,snake.dy=0):40===e.which&&0===snake.dy&&(snake.dy=grid,snake.dx=0)})),document.getElementById("btn-up").onclick=()=>{0===snake.dy&&(snake.dy=-grid,snake.dx=0)},document.getElementById("btn-left").onclick=()=>{0===snake.dx&&(snake.dx=-grid,snake.dy=0)},document.getElementById("btn-right").onclick=()=>{0===snake.dx&&(snake.dx=grid,snake.dy=0)},document.getElementById("btn-down").onclick=()=>{0===snake.dy&&(snake.dx=0,snake.dy=grid)},requestAnimationFrame(loop);